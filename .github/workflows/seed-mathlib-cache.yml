name: Seed Mathlib Cache

on:
  workflow_dispatch:
    inputs:
      tarball_url:
        description: 'URL to mathlib tarball (e.g., GitHub release asset URL)'
        required: true
        type: string

jobs:
  seed:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout (for manifest hash)
        uses: actions/checkout@v4

      - name: Download and extract mathlib
        run: |
          mkdir -p .lake/packages
          cd .lake/packages
          curl -L "${{ inputs.tarball_url }}" | tar -xz
          echo "Extracted mathlib:"
          find mathlib -name "*.olean" | wc -l
          echo "oleans found"

      - name: Save mathlib cache
        uses: actions/cache/save@v4
        with:
          path: .lake/packages/mathlib
          key: mathlib-${{ runner.os }}-${{ hashFiles('lake-manifest.json') }}

      - name: Done
        run: echo "Cache seeded! Key = mathlib-${{ runner.os }}-${{ hashFiles('lake-manifest.json') }}"
